"use strict";(self.webpackChunkcms_survivor=self.webpackChunkcms_survivor||[]).push([[4263],{54920:(I,r,e)=>{e.d(r,{R:()=>s});var t=e(68835),a=e(88767);function s(o={},f={}){const{id:l="",...n}=o,{get:g}=(0,t.kY)(),{data:i,isError:d,isLoading:c,refetch:v}=(0,a.useQuery)(["users",l,n],async()=>{const{data:{data:y}}=await g(`/admin/users/${l}`,{params:n});return y},f);let M=[];return l&&i?M=[i]:Array.isArray(i?.results)&&(M=i.results),{users:M,pagination:i?.pagination??null,isLoading:c,isError:d,refetch:v}}},93552:(I,r,e)=>{e.r(r),e.d(r,{default:()=>re});var t=e(67294),a=e(68835),s=e(86706),o=e(16550),f=e(36364),l=e(40720),n=e(90731),g=e(12473),i=e(34726),d=e(16607),c=e(96987),v=e(10574),M=e(31988),y=e(6498),L=e(18226),B=e(97695),Z=e(41054),C=e(27361),S=e.n(C),$=e(57557),F=e.n($),H=e(78718),A=e.n(H),N=e(45697),V=e.n(N),Y=e(86896),w=e(54920),X=e(80902),p=e(96854),ee=e(30164),te=e(85078),ae=e(39394);const se=async(D,u)=>{const{put:T}=(0,a.tg)(),{data:U}=await T(`/admin/users/${D}`,u);return U.data},ne=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],J=["email","firstname","lastname","username","isActive","roles"],b=({canUpdate:D})=>{const{formatMessage:u}=(0,Y.Z)(),{params:{id:T}}=(0,o.$B)("/settings/users/:id"),{push:U}=(0,o.k6)(),{setUserDisplayName:W}=(0,a.L7)(),h=(0,a.lm)(),{lockApp:G,unlockApp:Q}=(0,a.o1)(),k=(0,X.c)(ee.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE);(0,a.go)();const{users:[K],isLoading:le}=(0,w.R)({id:T},{cacheTime:0,onError(m){const{status:E}=m.response;E===403?(h({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),U("/")):h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),ie=async(m,E)=>{G();try{const P=await se(T,F()(m,"confirmPassword"));h({type:"success",message:u({id:"notification.success.saved",defaultMessage:"Saved"})});const R=a.I8.getUserInfo();if(T.toString()===R.id.toString()){a.I8.setUserInfo(P);const x=S()(m,"username")||(0,p.Pp)(m.firstname,m.lastname);W(x)}E.setValues(A()(m,J))}catch(P){const R=(0,p.Iz)(P.response.data),x=Object.keys(R).reduce((j,O)=>(j[O]=R[O].id,j),{});E.setErrors(x),h({type:"warning",message:S()(P,"response.data.error.message","notification.error")})}Q()},_=le||!k,de=_?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},z=Object.keys(A()(K,J)).reduce((m,E)=>E==="roles"?(m[E]=(K?.roles||[]).map(({id:P})=>P),m):(m[E]=K?.[E],m),{}),ce=z.username||(0,p.Pp)(z.firstname,z.lastname),q=u(de,{name:ce});return _?t.createElement(l.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"Users"}),t.createElement(n.T,{primaryAction:t.createElement(g.z,{disabled:!0,startIcon:t.createElement(L.Z,null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:q,navigationAction:t.createElement(a.rU,{startIcon:t.createElement(B.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(i.D,null,t.createElement(a.dO,null))):t.createElement(l.o,null,t.createElement(a.SL,{name:"Users"}),t.createElement(Z.J9,{onSubmit:ie,initialValues:z,validateOnChange:!1,validationSchema:ae.YM},({errors:m,values:E,handleChange:P,isSubmitting:R,dirty:x})=>t.createElement(a.l0,null,t.createElement(n.T,{primaryAction:t.createElement(g.z,{disabled:R||!D?!0:!x,startIcon:t.createElement(L.Z,null),loading:R,type:"submit",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:q,navigationAction:t.createElement(a.rU,{startIcon:t.createElement(B.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(i.D,null,K?.registrationToken&&t.createElement(d.x,{paddingBottom:6},t.createElement(k,{registrationToken:K.registrationToken})),t.createElement(c.k,{direction:"column",alignItems:"stretch",gap:7},t.createElement(d.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(c.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(v.Z,{variant:"delta",as:"h2"},u({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(M.r,{gap:5},ne.map(j=>j.map(O=>t.createElement(y.P,{key:O.name,...O.size},t.createElement(a.jm,{...O,disabled:!D,error:m[O.name],onChange:P,value:E[O.name]||""}))))))),t.createElement(d.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(c.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(v.Z,{variant:"delta",as:"h2"},u({id:"global.roles",defaultMessage:"User's role"})),t.createElement(M.r,{gap:5},t.createElement(y.P,{col:6,xs:12},t.createElement(te.Z,{disabled:!D,error:m.roles,onChange:P,value:E.roles}))))))))))};b.propTypes={canUpdate:V().bool.isRequired};const oe=b,re=()=>{const D=(0,a.lm)(),u=(0,s.v9)(f._),T=t.useMemo(()=>({read:u.settings.users.read,update:u.settings.users.update}),[u.settings.users]),{isLoading:U,allowedActions:{canRead:W,canUpdate:h}}=(0,a.ss)(T),{state:G}=(0,o.TH)(),Q=G?.from??"/";return(0,t.useEffect)(()=>{U||!W&&!h&&D({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[U,W,h,D]),U?t.createElement(a.dO,null):!W&&!h?t.createElement(o.l_,{to:Q}):t.createElement(oe,{canUpdate:h})}},6324:(I,r,e)=>{e.d(r,{Z:()=>i});var t=e(67294),a=e(96208),s=e(68835),o=e(43838),f=e(45697),l=e.n(f),n=e(86896);const g=({children:d,target:c})=>{const v=(0,s.lm)(),{formatMessage:M}=(0,n.Z)(),{copy:y}=(0,s.VP)(),L=M({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),B=async()=>{await y(c)&&v({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(s.Y_,{endAction:t.createElement(a.h,{label:L,noBorder:!0,icon:t.createElement(o.Z,null),onClick:B}),title:c,titleEllipsis:!0,subtitle:d,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};g.propTypes={children:l().oneOfType([l().element,l().string]).isRequired,target:l().string.isRequired};const i=g},30164:(I,r,e)=>{e.d(r,{A:()=>n});var t=e(67294),a=e(45697),s=e.n(a),o=e(86896),f=e(95651),l=e(6324);const n=({registrationToken:g})=>{const{formatMessage:i}=(0,o.Z)(),d=`${window.location.origin}${f.Z}auth/register?registrationToken=${g}`;return t.createElement(l.Z,{target:d},i({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:s().string}},85078:(I,r,e)=>{e.d(r,{Z:()=>B});var t=e(67294),a=e(59586),s=e(40933),o=e(68835),f=e(2),l=e(45697),n=e.n(l),g=e(86896),i=e(88767),d=e(88972);const c=(0,d.F4)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,v=d.ZP.div`
  animation: ${c} 2s infinite linear;
`,M=()=>t.createElement(v,null,t.createElement(f.Z,null)),y=async()=>{const{get:Z}=(0,o.tg)(),{data:C}=await Z("/admin/roles");return C.data},L=({disabled:Z,error:C,onChange:S,value:$})=>{const{status:F,data:H}=(0,i.useQuery)(["roles"],y,{staleTime:5e4}),{formatMessage:A}=(0,g.Z)(),N=C?A({id:C,defaultMessage:C}):"",V=A({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),Y=A({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),w=A({id:"app.components.Select.placeholder",defaultMessage:"Select"}),X=F==="loading"?t.createElement(M,null):void 0;return t.createElement(a.P,{id:"roles",disabled:Z,error:N,hint:Y,label:V,name:"roles",onChange:p=>{S({target:{name:"roles",value:p}})},placeholder:w,multi:!0,startIcon:X,value:$.map(p=>p.toString()),withTags:!0,required:!0},(H||[]).map(p=>t.createElement(s.W,{key:p.id,value:p.id.toString()},A({id:`global.${p.code}`,defaultMessage:p.name}))))};L.defaultProps={disabled:!1,error:void 0},L.propTypes={disabled:n().bool,error:n().string,onChange:n().func.isRequired,value:n().array.isRequired};const B=L},39394:(I,r,e)=>{e.d(r,{YM:()=>i,Rw:()=>f});var t=e(87561),a=e(68835);const s={firstname:t.Z_().trim().required(a.I0.required),lastname:t.Z_(),email:t.Z_().email(a.I0.email).lowercase().required(a.I0.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.I0.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.I0.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(d,c)=>d?c.required(a.I0.required):c)},f={...s,currentPassword:t.Z_().when(["password","confirmPassword"],(d,c,v)=>d||c?v.required(a.I0.required):v),preferedLanguage:t.Z_().nullable()},n={roles:t.IX().min(1,a.I0.required).required(a.I0.required)},i=t.Ry().shape({...s,isActive:t.Xg(),...n})},97695:(I,r,e)=>{e.d(r,{Z:()=>s});var t=e(85893);const a=o=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...o,children:(0,t.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),s=a},43838:(I,r,e)=>{e.d(r,{Z:()=>s});var t=e(85893);const a=o=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...o,children:[(0,t.jsx)("path",{fill:"#212134",d:"M1.056 24h15.906c.583 0 1.056-.473 1.056-1.056V7.028c0-.583-.473-1.056-1.056-1.056H1.056C.473 5.972 0 6.445 0 7.028v15.916C0 23.527.473 24 1.056 24Z"}),(0,t.jsx)("path",{fill:"#212134",d:"M8.094 2.111h13.795v13.795h-1.127v2.112h2.182A1.056 1.056 0 0 0 24 16.962V1.056A1.056 1.056 0 0 0 22.944 0H7.038a1.056 1.056 0 0 0-1.056 1.056v2.252h2.112V2.11Z"})]}),s=a}}]);
