"use strict";(self.webpackChunkcms_survivor=self.webpackChunkcms_survivor||[]).push([[5199],{54920:(U,o,e)=>{e.d(o,{R:()=>l});var t=e(68835),n=e(88767);function l(r={},u={}){const{id:a="",...s}=r,{get:g}=(0,t.kY)(),{data:i,isError:p,isLoading:y,refetch:C}=(0,n.useQuery)(["users",a,s],async()=>{const{data:{data:h}}=await g(`/admin/users/${a}`,{params:s});return h},u);let D=[];return a&&i?D=[i]:Array.isArray(i?.results)&&(D=i.results),{users:D,pagination:i?.pagination??null,isLoading:y,isError:p,refetch:C}}},71359:(U,o,e)=>{e.d(o,{Z:()=>p});var t=e(67294),n=e(16607),l=e(12473),r=e(68835),u=e(52933),a=e(45697),s=e.n(a),g=e(86896);const i=({displayedFilters:y})=>{const[C,D]=(0,t.useState)(!1),{formatMessage:h}=(0,g.Z)(),T=(0,t.useRef)(),W=()=>{D(A=>!A)};return t.createElement(t.Fragment,null,t.createElement(n.x,{paddingTop:1,paddingBottom:1},t.createElement(l.z,{variant:"tertiary",ref:T,startIcon:t.createElement(u.Z,null),onClick:W,size:"S"},h({id:"app.utils.filters",defaultMessage:"Filters"})),C&&t.createElement(r.J5,{displayedFilters:y,isVisible:C,onToggle:W,source:T})),t.createElement(r.W$,{filtersSchema:y}))};i.propTypes={displayedFilters:s().arrayOf(s().shape({name:s().string.isRequired,metadatas:s().shape({label:s().string}),fieldSchema:s().shape({type:s().string})})).isRequired};const p=i},61611:(U,o,e)=>{e.d(o,{W:()=>pe,Z:()=>Ze});var t=e(67294),n=e(40720),l=e(90731),r=e(55040),u=e(34726),a=e(68835),s=e(80129),g=e.n(s),i=e(86896),p=e(88767),y=e(86706),C=e(16550),D=e(54920),h=e(80902),T=e(36364),W=e(71359),A=e(12473),Z=e(24116),se=e(45697),d=e.n(se);const q=({onClick:c})=>{const{formatMessage:M}=(0,i.Z)();return t.createElement(A.z,{onClick:c,startIcon:t.createElement(Z.Z,null),size:"S"},M({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};q.propTypes={onClick:d().func.isRequired};var ne=e(35752),F=e(29299),G=e(69398),le=e(12803),b=e(10574),j=e(96987),ee=e(96208),E=e(16607),Me=e(2382),fe=e(54425),re=e(96854);const oe=({canDelete:c,headers:M,entriesToDelete:L,onClickDelete:k,onSelectRow:$,withMainAction:z,withBulkActions:x,rows:I})=>{const{push:P,location:{pathname:H}}=(0,C.k6)(),{formatMessage:O}=(0,i.Z)();return t.createElement(ne.p,null,I.map(m=>{const V=L.findIndex(B=>B===m.id)!==-1;return t.createElement(F.Tr,{key:m.id,...(0,a.X7)({fn:()=>P(`${H}/${m.id}`),condition:x})},z&&t.createElement(G.Td,{...a.UW},t.createElement(le.C,{"aria-label":O({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,re.Pp)(m.firstname,m.lastname)}),checked:V,onChange:()=>{$({name:m.id,value:!V})}})),M.map(({key:B,cellFormatter:Y,name:K,...N})=>t.createElement(G.Td,{key:B},typeof Y=="function"?Y(m,{key:B,name:K,formatMessage:O,...N}):t.createElement(b.Z,{textColor:"neutral800"},m[K]||"-"))),x&&t.createElement(G.Td,null,t.createElement(j.k,{justifyContent:"end"},t.createElement(ee.h,{onClick:()=>P(`${H}/${m.id}`),label:O({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,re.Pp)(m.firstname,m.lastname)}),noBorder:!0,icon:t.createElement(Me.Z,null)}),c&&t.createElement(E.x,{paddingLeft:1,...a.UW},t.createElement(ee.h,{onClick:()=>k(m.id),label:O({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,re.Pp)(m.firstname,m.lastname)}),noBorder:!0,icon:t.createElement(fe.Z,null)})))))}))};oe.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},oe.propTypes={canDelete:d().bool,entriesToDelete:d().array,headers:d().array.isRequired,onClickDelete:d().func,onSelectRow:d().func,rows:d().array,withBulkActions:d().bool,withMainAction:d().bool};const ve=oe;var he=e(74622),Pe=e(36854),ye=e(71543),de=e(31988),ie=e(6498),Ce=e(37022),De=e(82392),Ae=e(75071),Oe=e(41054),Te=e(30164),Le=e(85078),J=e(87561);const ue={firstname:"",lastname:"",email:"",roles:[]},Re=[],Ue=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ie=J.Ry().shape({firstname:J.Z_().trim().required(a.I0.required),lastname:J.Z_(),email:J.Z_().email(a.I0.email).required(a.I0.required),roles:J.IX().min(1,a.I0.required).required(a.I0.required)}),Be={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Ee=({onSuccess:c,onToggle:M})=>{const[L,k]=(0,t.useState)("create"),[$,z]=(0,t.useState)(!1),[x,I]=(0,t.useState)(null),{formatMessage:P}=(0,i.Z)(),H=(0,a.lm)(),{lockApp:O,unlockApp:m}=(0,a.o1)(),{post:V}=(0,a.kY)(),B=(0,h.c)(Re,async()=>(await e.e(9329).then(e.bind(e,99329))).ROLE_LAYOUT,{combine(v,S){return[...v,S]},defaultValue:[]}),Y=(0,h.c)(ue,async()=>(await e.e(9329).then(e.bind(e,99329))).FORM_INITIAL_VALUES,{combine(v,S){return{...v,...S}},defaultValue:ue}),K=(0,h.c)(Te.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE),N=(0,p.useMutation)(v=>V("/admin/users",v),{async onSuccess({data:v}){I(v.data.registrationToken),await c(),ae(),z(!1)},onError(v){throw z(!1),H({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),v},onSettled(){m()}}),w=P({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),te=async(v,{setErrors:S})=>{O(),z(!0);try{await N.mutateAsync(v)}catch(X){m(),X?.response?.data?.error.message==="Email already taken"&&S({email:X.response.data.error.message})}},ae=()=>{f?k(f):M()},{buttonSubmitLabel:_,isDisabled:Q,next:f}=Be[L],Fe=L==="create"?t.createElement(A.z,{type:"submit",loading:$},P(_)):t.createElement(A.z,{type:"button",loading:$,onClick:M},P(_));return K?t.createElement(he.P,{onClose:M,labelledBy:"title"},t.createElement(Pe.x,null,t.createElement(De.O,{label:w},t.createElement(Ae.$,{isCurrent:!0},w))),t.createElement(Oe.J9,{enableReinitialize:!0,initialValues:Y,onSubmit:te,validationSchema:Ie,validateOnChange:!1},({errors:v,handleChange:S,values:X})=>t.createElement(a.l0,null,t.createElement(ye.f,null,t.createElement(j.k,{direction:"column",alignItems:"stretch",gap:6},L!=="create"&&t.createElement(K,{registrationToken:x}),t.createElement(E.x,null,t.createElement(b.Z,{variant:"beta",as:"h2"},P({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),t.createElement(E.x,{paddingTop:4},t.createElement(j.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(de.r,{gap:5},Ue.map(me=>me.map(R=>t.createElement(ie.P,{key:R.name,...R.size},t.createElement(a.jm,{...R,disabled:Q,error:v[R.name],onChange:S,value:X[R.name]})))))))),t.createElement(E.x,null,t.createElement(b.Z,{variant:"beta",as:"h2"},P({id:"global.roles",defaultMessage:"User's role"})),t.createElement(E.x,{paddingTop:4},t.createElement(de.r,{gap:5},t.createElement(ie.P,{col:6,xs:12},t.createElement(Le.Z,{disabled:Q,error:v.roles,onChange:S,value:X.roles})),B.map(me=>me.map(R=>t.createElement(ie.P,{key:R.name,...R.size},t.createElement(a.jm,{...R,disabled:Q,onChange:S,value:X[R.name]}))))))))),t.createElement(Ce.m,{startActions:t.createElement(A.z,{variant:"tertiary",onClick:M,type:"button"},P({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:Fe})))):null};Ee.propTypes={onToggle:d().func.isRequired,onSuccess:d().func.isRequired};const Se=Ee,ce=({pagination:c})=>t.createElement(E.x,{paddingTop:4},t.createElement(j.k,{alignItems:"flex-end",justifyContent:"space-between"},t.createElement(a.v4,null),t.createElement(a.tU,{pagination:c})));ce.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},ce.propTypes={pagination:d().shape({page:d().number,pageCount:d().number,pageSize:d().number,total:d().number})};const We=ce,xe=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Ke=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:c},{formatMessage:M}){return t.createElement(b.Z,{textColor:"neutral800"},c.map(L=>M({id:`Settings.permissions.users.${L.code}`,defaultMessage:L.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:c},{formatMessage:M}){return t.createElement(j.k,null,t.createElement(a.qb,{isActive:c,variant:c?"success":"danger"}),t.createElement(b.Z,{textColor:"neutral800"},M({id:c?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:c?"Active":"Inactive"})))}}],ge=["ee","license-limit-info"],pe=()=>{const{post:c}=(0,a.kY)(),{formatAPIError:M}=(0,a.So)(),[L,k]=(0,t.useState)(!1),$=(0,y.v9)(T._),{allowedActions:{canCreate:z,canDelete:x,canRead:I}}=(0,a.ss)($.settings.users),P=(0,p.useQueryClient)(),H=(0,a.lm)(),{formatMessage:O}=(0,i.Z)(),{search:m}=(0,C.TH)();(0,a.go)();const{users:V,pagination:B,isError:Y,isLoading:K,refetch:N}=(0,D.R)(g().parse(m,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:I}),w=(0,h.c)(q,async()=>(await e.e(5833).then(e.bind(e,85833))).CreateActionEE),te=Ke.map(f=>({...f,metadatas:{...f.metadatas,label:O(f.metadatas.label)}})),ae=O({id:"global.users",defaultMessage:"Users"}),_=()=>{k(f=>!f)},Q=(0,p.useMutation)(async f=>{await c("/admin/users/batch-delete",{ids:f})},{async onSuccess(){await N(),await P.refetchQueries(ge)},onError(f){H({type:"warning",message:{id:"notification.error",message:M(f),defaultMessage:"An error occured"}})}});return w?t.createElement(n.o,{"aria-busy":K},t.createElement(a.SL,{name:"Users"}),t.createElement(l.T,{primaryAction:z&&t.createElement(w,{onClick:_}),title:ae,subtitle:O({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),I&&t.createElement(r.Z,{startActions:t.createElement(t.Fragment,null,t.createElement(a.m,{label:O({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ae})}),t.createElement(W.Z,{displayedFilters:xe}))}),t.createElement(u.D,{canRead:I},!I&&t.createElement(a.ZF,null),Y&&t.createElement("div",null,"TODO: An error occurred"),I&&t.createElement(t.Fragment,null,t.createElement(a.tM,{contentType:"Users",isLoading:K,onConfirmDeleteAll:Q.mutateAsync,onConfirmDelete:f=>Q.mutateAsync([f]),headers:te,rows:V,withBulkActions:!0,withMainAction:x},t.createElement(ve,{canDelete:x,headers:te,rows:V,withBulkActions:!0,withMainAction:x})),B&&t.createElement(We,{pagination:B}))),L&&t.createElement(Se,{onSuccess:async()=>{await N(),await P.refetchQueries(ge)},onToggle:_})):null},Ze=()=>{const c=(0,h.c)(pe,async()=>(await e.e(5481).then(e.bind(e,17403))).UserListPageEE);return c?t.createElement(c,null):null}},87901:(U,o,e)=>{e.r(o),e.d(o,{default:()=>s});var t=e(67294),n=e(68835),l=e(86706),r=e(36364),u=e(61611);const s=()=>{const g=(0,l.v9)(r._);return t.createElement(n.O4,{permissions:g.settings.users.main},t.createElement(u.Z,null))}},6324:(U,o,e)=>{e.d(o,{Z:()=>i});var t=e(67294),n=e(96208),l=e(68835),r=e(43838),u=e(45697),a=e.n(u),s=e(86896);const g=({children:p,target:y})=>{const C=(0,l.lm)(),{formatMessage:D}=(0,s.Z)(),{copy:h}=(0,l.VP)(),T=D({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),W=async()=>{await h(y)&&C({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(l.Y_,{endAction:t.createElement(n.h,{label:T,noBorder:!0,icon:t.createElement(r.Z,null),onClick:W}),title:y,titleEllipsis:!0,subtitle:p,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};g.propTypes={children:a().oneOfType([a().element,a().string]).isRequired,target:a().string.isRequired};const i=g},30164:(U,o,e)=>{e.d(o,{A:()=>s});var t=e(67294),n=e(45697),l=e.n(n),r=e(86896),u=e(95651),a=e(6324);const s=({registrationToken:g})=>{const{formatMessage:i}=(0,r.Z)(),p=`${window.location.origin}${u.Z}auth/register?registrationToken=${g}`;return t.createElement(a.Z,{target:p},i({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:l().string}},85078:(U,o,e)=>{e.d(o,{Z:()=>W});var t=e(67294),n=e(59586),l=e(40933),r=e(68835),u=e(2),a=e(45697),s=e.n(a),g=e(86896),i=e(88767),p=e(88972);const y=(0,p.F4)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,C=p.ZP.div`
  animation: ${y} 2s infinite linear;
`,D=()=>t.createElement(C,null,t.createElement(u.Z,null)),h=async()=>{const{get:A}=(0,r.tg)(),{data:Z}=await A("/admin/roles");return Z.data},T=({disabled:A,error:Z,onChange:se,value:d})=>{const{status:q,data:ne}=(0,i.useQuery)(["roles"],h,{staleTime:5e4}),{formatMessage:F}=(0,g.Z)(),G=Z?F({id:Z,defaultMessage:Z}):"",le=F({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),b=F({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),j=F({id:"app.components.Select.placeholder",defaultMessage:"Select"}),ee=q==="loading"?t.createElement(D,null):void 0;return t.createElement(n.P,{id:"roles",disabled:A,error:G,hint:b,label:le,name:"roles",onChange:E=>{se({target:{name:"roles",value:E}})},placeholder:j,multi:!0,startIcon:ee,value:d.map(E=>E.toString()),withTags:!0,required:!0},(ne||[]).map(E=>t.createElement(l.W,{key:E.id,value:E.id.toString()},F({id:`global.${E.code}`,defaultMessage:E.name}))))};T.defaultProps={disabled:!1,error:void 0},T.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const W=T},55040:(U,o,e)=>{e.d(o,{Z:()=>l});var t=e(85893),n=e(96987);const l=({startActions:r,endActions:u})=>!r&&!u?null:(0,t.jsxs)(n.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,t.jsx)(n.k,{gap:2,wrap:"wrap",children:r}),(0,t.jsx)(n.k,{gap:2,shrink:0,wrap:"wrap",children:u})]})},43838:(U,o,e)=>{e.d(o,{Z:()=>l});var t=e(85893);const n=r=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...r,children:[(0,t.jsx)("path",{fill:"#212134",d:"M1.056 24h15.906c.583 0 1.056-.473 1.056-1.056V7.028c0-.583-.473-1.056-1.056-1.056H1.056C.473 5.972 0 6.445 0 7.028v15.916C0 23.527.473 24 1.056 24Z"}),(0,t.jsx)("path",{fill:"#212134",d:"M8.094 2.111h13.795v13.795h-1.127v2.112h2.182A1.056 1.056 0 0 0 24 16.962V1.056A1.056 1.056 0 0 0 22.944 0H7.038a1.056 1.056 0 0 0-1.056 1.056v2.252h2.112V2.11Z"})]}),l=n},24116:(U,o,e)=>{e.d(o,{Z:()=>l});var t=e(85893);const n=r=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...r,children:[(0,t.jsx)("path",{fill:"#32324D",d:"M0 2.8A.8.8 0 0 1 .8 2h22.4a.8.8 0 0 1 .8.8v2.71a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2.8Z"}),(0,t.jsx)("path",{fill:"#32324D",d:"M1.922 7.991C.197 6.675 0 6.252 0 5.289h23.953c.305 1.363-1.594 2.506-2.297 3.125-1.953 1.363-6.253 4.36-7.828 5.45-1.575 1.09-3.031.455-3.562 0-2.063-1.41-6.62-4.557-8.344-5.873ZM22.8 18H1.2c-.663 0-1.2.471-1.2 1.053v1.894C0 21.529.537 22 1.2 22h21.6c.663 0 1.2-.471 1.2-1.053v-1.894c0-.582-.537-1.053-1.2-1.053Z"}),(0,t.jsx)("path",{fill:"#32324D",d:"M0 9.555v10.972h24V9.554c-2.633 1.95-8.367 6.113-9.96 7.166-1.595 1.052-3.352.438-4.032 0L0 9.555Z"})]}),l=n}}]);
